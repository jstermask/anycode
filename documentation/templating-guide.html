<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by JJB : Apache Maven Doxia Site Renderer 1.4 at 2019-06-12 -->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
            <title>astah-anycode-plugin - 
		Templating guide</title>
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <meta name="description" content="">
                                                                                    <meta name="Date-Revision-yyyymmdd" content="20190612" />
                                                                <meta http-equiv="Content-Language" content="en" />
                                        <!-- Le styles -->
                    <link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet">
                        <link href="../bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
                            <link href="../css/maven-theme.css" rel="stylesheet">
                                <link href="../css/site.css" rel="stylesheet">
                                    <link href="../css/print.css" rel="stylesheet" media="print" />
                                                                                
<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new
				Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
				ga('create', 'UA-41772181-2', 'labulle.in');
				ga('send', 'pageview');</script>
                                                                                                                
                                        </head>
<body class="">
	<div class="stripe"></div>
    <div class="banner">
		<div class="navbar navbar-static-top">             
	        	        	<a class="logo" href="../index.html"><span class="anycode-logo">any<em>&lt;code/&gt;</em></span></a>
	        	        <ul class="nav pull-right" role="navigation">
	        	                                    <li class="dropdown">
            	<a id="drop1" class="dropdown-toggle" data-toggle="dropdown" role="button" href="#">
            		Documentation
            		<b class="caret"></b>
            	</a>
                            <ul class="dropdown-menu" aria-labelledby="drop1" role="menu">
                                    	<li role="presentation">

                                                    <a href="../documentation/install-guide.html" title="Install Guide">Install Guide</a>
                    </li>
                                    	<li role="presentation">

                                                    <a href="../documentation/reference-documentation.html" title="Reference documentation">Reference documentation</a>
                    </li>
                                    	<li role="presentation">

                                                    <a href="../api/anycode-uml-api/apidocs/index.html" title="Anycode UML API">Anycode UML API</a>
                    </li>
                                                                                                            	<li class="dropdown-submenu" role="presentation">

                                                    <a href="../directives/directives.html" title="Built-in directives">Built-in directives</a>
                                        <ul class="dropdown-menu" role="menu">
                                    	<li role="presentation">

                                                    <a href="../api/anycode-directive-api/apidocs/in/labulle/anycode/engine/groovy/directive/JavaDirective.html" title="Java">Java</a>
                    </li>
                                    	<li role="presentation">

                                                    <a href="../api/anycode-directive-api/apidocs/in/labulle/anycode/engine/groovy/directive/JpaDirective.html" title="JPA 2.0">JPA 2.0</a>
                    </li>
                                    	<li role="presentation">

                                                    <a href="../api/anycode-directive-api/apidocs/in/labulle/anycode/engine/groovy/directive/SpringDirective.html" title="Spring">Spring</a>
                    </li>
                                    	<li role="presentation">

                                                    <a href="../api/anycode-directive-api/apidocs/in/labulle/anycode/engine/groovy/directive/ObjectiveCDirective.html" title="Objective-C">Objective-C</a>
                    </li>
                            </ul>
            </li>
                                                                                                	<li class="dropdown-submenu" role="presentation">

                                                    <a href="../tutorials/tutorials.html" title="Tutorials">Tutorials</a>
                                        <ul class="dropdown-menu" role="menu">
                                    	<li role="presentation">

                                                    <a href="../tutorials/tutorial-java-helloworld.html" title="Java tutorial - Hello World">Java tutorial - Hello World</a>
                    </li>
                                    	<li role="presentation">

                                                    <a href="../tutorials/tutorial-jpa-basics.html" title="JPA tutorial - Basics">JPA tutorial - Basics</a>
                    </li>
                                    	<li role="presentation">

                                                    <a href="../tutorials/tutorial-objc-basics.html" title="Objective-C tutorial - Basics">Objective-C tutorial - Basics</a>
                    </li>
                            </ul>
            </li>
                            </ul>
                    </li>
                                    <li class="dropdown">
            	<a id="drop2" class="dropdown-toggle" data-toggle="dropdown" role="button" href="#">
            		About
            		<b class="caret"></b>
            	</a>
                            <ul class="dropdown-menu" aria-labelledby="drop2" role="menu">
                                    	<li role="presentation">

                                                    <a href="../about/news.html" title="Release notes">Release notes</a>
                    </li>
                                    	<li role="presentation">

                                                    <a href="../about/roadmap.html" title="Road Map">Road Map</a>
                    </li>
                                    	<li role="presentation">

                                                    <a href="../about/license.html" title="License">License</a>
                    </li>
                                    	<li role="presentation">

                                                    <a href="../about/author.html" title="Author">Author</a>
                    </li>
                            </ul>
                    </li>
    	        </ul>
	    </div>
    </div>
    <div class="container-narrow">
                
	
		<h1>2. Templating Guide</h1>
		<a name="s1"></a>
		
<div class="section">
<h2>2.1. Template File structure<a name="a2.1._Template_File_structure"></a></h2>
			<a name="s11"></a>
			
<div class="section">
<h3>2.1.1. Naming convention<a name="a2.1.1._Naming_convention"></a></h3>
			
<p>A template is a parameterized &quot;document&quot; that will be turned into text file thanks to a template engine.
			</p>
			
<p>In anycode, it is actually a set of 2 files that describe both <b>the path (name)</b> of the file to be generated and <b>its content</b>. They must be created
				altogether in the same directory and must comply with the following naming convention:
			</p>
			
<table border="0" class="table table-bordered">
				
<tr class="a">
					
<th>Prefix</th>
					
<th>Suffix</th>
					
<th>Extension</th>
					
<th>Description</th>
					
<th>Example</th>
				</tr>
				
<tr class="b">
					
<td>Any valid filename</td>
					
<td>-name</td>
					
<td>.mda or .mdm</td>
					
<td>Template that is responsible for generating source code file's path
					</td>
					
<td>foo-name.mda</td>
				</tr>
				
<tr class="a">
					
<td>Any valid filename</td>
					
<td>-content</td>
					
<td>.mda or .mdm</td>
					
<td>Template that is responsible for generating source code content
					</td>
					
<td>foo-content.mda</td>
				</tr>
			</table>
			
<p>
				2 files
				<i>foo</i>
				-name.mda and
				<i>foo</i>
				-content.mda compose one template identified as
				<i>foo</i>
				template.
			</p>
			
<p class="center">
				<img src="../images/template-structure.png" class="img-polaroid" alt="" />
			</p>
			</div>
			<a name="s12"></a>
			
<div class="section">
<h3>2.1.2. Scripting Language<a name="a2.1.2._Scripting_Language"></a></h3>
			
<p>Before 1.2.0, Anycode used to rely on freemarker language as template engine. Although that language is powerful and reusable thanks to
				directive mechanism, it was not so easy to learn for end users nor to test automatically (unit tests). In order to extend the tool, a decision
				was made to switch from Freemarker to Groovy, as it is closer to the well known JSP syntax, and Directives can be unit tested like any
				Groovy Class.
			</p>
			
<p>
				So starting from Anycode 1.2.0, we'll rely only on Groovy templating engine. The latter is used
				<i>as is</i>
				. As a consequence, learning its syntax is a prerequisite to using the plugin.
			</p>
			
<p>
				For more information on how to write templates with Groovy, please see
				<a class="externalLink" href="http://groovy.codehaus.org/Groovy+Templates" target="_blank">Groovy Templates manual</a>
			</p>
			
<p>The example below shows a template that generates a java class. It is made up of 2 files :</p>
			<b>MyTemplate-name.mda</b>
			
<div class="source">
<pre>${targetDir}/${c.getFullyQualifiedName(&quot;/&quot;)}.java</pre></div>
			<b>MyTemplate-content.mda</b>
			
<div class="source">
<pre>package ${c.owner.getFullyQualifiedName(&quot;.&quot;)}; 
${java.classifierSignature(c)} { 
	&lt;% def atts = c.attributes %&gt; 
	&lt;% atts.each() {%&gt; 
		${java.attribute(it)} 
	&lt;% } %&gt; 
	&lt;% atts.each() { %&gt; 
		${java.getter(it)} 
		${java.setter(it)} 
	&lt;% } %&gt; 
} </pre></div>
			
<p>Several variables are used here : &quot;c&quot;, &quot;java&quot;... These will be explained in Template context section.</p>
			</div>
			
			<a name="s13"></a>
			
<div class="section">
<h3>2.1.3. Choosing the right scope<a name="a2.1.3._Choosing_the_right_scope"></a></h3>
					
<p>Needs for code generation can be different from one developer to another. Some will want to generate their classes to a specific language, some
					other will prefer to generate a document for the whole model. They will therefore need to manipulate the model itself or only one of its classifiers.</p>
					
<p>Depending on file's extension name, a template can process either a classifier or the whole UML model :</p>
					
<ul>
						
<li>
							<b>*.mdm</b>
							extension : template will take the UML Model as a parameter. It means that it will be called only once and will generate only one single file.
						</li>
						
<li>
							<b>*.mda</b>
							extension : template will take each classifier (class or interface) as a parameter. It means that it will be called as many times as there are
							classifiers in the model.
						</li>
					</ul>
				</div>
			</div>
			<a name="s2"></a>
			
<div class="section">
<h2>2.2. Template context<a name="a2.2._Template_context"></a></h2>
				
<p> To generate files, template engine always passes a context to templates. It's a set of variables that you can call from the template:
				</p>
				
<table border="0" class="table table-bordered">
					
<tr class="a">
						
<th>Parameter name</th>
						
<th>Available for scope</th>
						
<th>Description</th>
						
<th>Type</th>
					</tr>
					
<tr class="b">
						
<td>m</td>
						
<td>Model scope (*.mdm) only</td>
						
<td>Anycode model instance. 
						</td>
						
<td>
							in.labulle.anycode.uml.IModel (from
							<a href="../api/anycode-uml-api/apidocs/index.html" target="_blank">Anycode UML API</a>
							)
						</td>
					</tr>
					
<tr class="a">
						
<td>c</td>
						
<td>Classifier scope (*.mda) only</td>
						
<td>Anycode class instance. This variable will help you generate most of the content of your source code.
						</td>
						
<td>
							in.labulle.anycode.uml.IClassifier (from
							<a href="../api/anycode-uml-api/apidocs/index.html" target="_blank">Anycode UML API</a>
							)
						</td>
					</tr>
					
<tr class="b">
						
<td>targetDir</td>
						
<td>any scope</td>
						
<td>Target directory that you chose from anycode configuration panel. This will be useful to build the name of the generated file (its path).
						</td>
						
<td>java.lang.String</td>
					</tr>
					
<tr class="a">
						
<td>templateDir</td>
						
<td>any scope</td>
						
<td>Template directory that you chose from anycode configuration panel. This is where you saved your template(s).
						</td>
						
<td>java.lang.String</td>
					</tr>
				</table>
				
<p>
					<b>NOTE</b>
					: IClassifier and IModel is an interface provided by
					<a href="../api/anycode-uml-api/apidocs/index.html" target="_blank">Anycode UML API</a>
					whose javadoc is available online
					<a href="../api/anycode-uml-api/apidocs/index.html" target="_blank">here</a>
					. It represents a class designed in Astah and wraps it so that it is even easier to use in templates. From the template, you can therefore access a
					UML Class information, its name, package, attributes, operations, relations, stereotypes... To sum up, you can have access to (almost?) anything
					you designed in your diagram. And the good news is that Anycode API is quite easy to use. For practical examples, please see
					<i>Language reference section</i>
					of this guide and also
					<i>Tutorials section</i>
					.
				</p>
			</div>
			<a name="s3"></a>
			
<div class="section">
<h2>2.3. Directives<a name="a2.3._Directives"></a></h2>
				
<p>Templates use UML model directly, through variables. This makes code generation straightforward. </p>
				
<p>However, their size will grow a lot if you don't have a way to reuse some functions. 
					Fortunately you can write custom &quot;directives&quot; in separate files and call their functions directly from your templates. This section will tell you how to do that.
				</p>
				<a name="s31"></a>
				
<div class="section">
<h3>2.3.1. Naming Convention<a name="a2.3.1._Naming_Convention"></a></h3>
				
<p>
				A Directive a just a <b>Groovy class</b>, saved in the template directory (directory templates are stored), and whose filename follows a specific naming convention : <b>[myCode]<i>-directive.mda</i></b>.
				This class is detected and processed by anycode, i.e. : an instance of the class is available in your template with &quot;myCode&quot; variable name.
				</p>
				
<p>
				Let's take an example : suppose you need to generate a PHP attribute of a class as well as its getters and setters. You can then write all the code in the directive as 
				you can see below.
				</p>
				<tt><b>myPhp-directive.mda</b></tt>
				
<div class="source">
<pre>
import in.labulle.anycode.uml.*;

class PhpDirective {
	def attribute(IAttribute a) {
		return &quot;&quot;&quot;private var \$${a.name};&quot;&quot;&quot;
	}
	
	def getter(IAttribute a) {
		return &quot;&quot;&quot;public function get${capitalize(a.name)}() {
			return \$this-&gt;${a.name};
		}&quot;&quot;&quot;
	}
	
	def setter(IAttribute a) {
		return &quot;&quot;&quot;pblic function set${capitalize(a.name)}(\$aValue) {
			\$this-&gt;${a.name} = \$aValue;
		}&quot;&quot;&quot;
	}
	
	def capitalize(String s) {
		return s[0].toUpperCase() + s.substring(1)
	}
}
				</pre></div>

<p>The above class is a Directive. This is a regular Groovy Class that imports Anycode API and that helps generating variable, getter and setter from a UML Attribute. There is no specific constraint regarding the class' name or its methods.
The only important thing to remember is to import the required dependencies (like any groovy class) and make sure that they are in Astah's classpath.
</p>

<p>Now, let's see how to use this directive in our template, thus reducing its code and improving its readability :</p>
				<tt><b>yetanothertemplate-name.mda</b></tt>
				
<div class="source">
<pre>
${targetDir}/${c.name}.php
				</pre></div> 
				<tt><b>yetanothertemplate-content.mda</b></tt>
				
<div class="source">
<pre>
&lt;?php
class ${c.name} {
	&lt;% c.attributes.each() { %&gt;
		${myPhp.attribute(it)} 
		${myPhp.getter(it)} 
		${myPhp.setter(it)} 
	&lt;% } %&gt;	
}
?&gt;</pre></div>
				
<p>And the result below with a simple Person class with 3 attributes :</p>
				
				<tt><b>Person.php</b></tt>

<div class="source">
<pre>
&lt;?php
class Person {
private var $firstname;
public function getFirstname() {
	return $this-&gt;firstname;
}
	
public function setFirstname($aFirstname) {
	$this-&gt;firstname = $aFirstname;
}

private var $lastname;
public function getLastname() {
	return $this-&gt;lastname;
}
	
public function setLastname($aLastname) {
	$this-&gt;lastname = $aLastname;
}

private var $birthdate;
public function getBirthdate() {
	return $this-&gt;birthdate;
}
	
public function setBirthdate($aBirthdate) {
	$this-&gt;birthdate = $aBirthdate;
}
}
?&gt;</pre></div>
				</div>
				<a name="s32"></a>			
				
<div class="section">
<h3>2.3.2. Built-in directives<a name="a2.3.2._Built-in_directives"></a></h3>
				
<p>anycode provides a few directives out of the box for Java, JPA/Hibernate/Spring-Data, Objective-C (limited support). Please read <a href="../directives/directives.html">Directives API</a>for further details.</p>
				</div>
			</div>
	
 
        <div class="clear"></div>
    </div>
    <footer class="navbar-fixed-bottom">
        <div class="container-narrow">
            <p class="pull-right">
            	                                                <a href="https://bitbucket.org/jjbcarreno/anycode/issues" class="externalLink" target="_blank" title="Issue Tracker">Issue Tracker</a>
                        	<a href="../index.html"><i class="icon-home icon-white"></i>Home</a>
                <a href="#"><i class="icon-arrow-up icon-white"></i>Top</a>
            </p>
            <p>                        2013-2019
            <a href="http://www.labulle.in">LaBulle.in</a>.
        </p>
        </div>
    </footer>
    <script src="../bootstrap/assets/js/jquery.js"></script>
    <script src="../bootstrap/js/bootstrap.min.js"></script>  
</body>
</html>
